---
layout: default
title: API Reference
---
<section class="py-20 px-4 pt-32">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">WebSocket API</h2>
    <p class="text-slate-400 text-center mb-4 max-w-2xl mx-auto">All communication happens over WebSocket at <code class="text-capy-400">ws://agent:&lt;port&gt;/ws</code></p>
    <p class="text-center mb-12">
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-green-400 text-sm">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
        Primary Protocol
      </span>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/20 text-yellow-400 text-sm ml-2">
        HTTP endpoints are deprecated
      </span>
    </p>

    <!-- Message Format -->
    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6 mb-8">
      <h3 class="text-lg font-semibold mb-4">Message Format</h3>
      <pre class="bg-slate-950 rounded-xl p-4 overflow-x-auto text-sm"><code class="text-slate-300">{
  <span class="text-capy-400">"id"</span>: <span class="text-green-400">"unique-message-id"</span>,
  <span class="text-capy-400">"type"</span>: <span class="text-green-400">"message_type"</span>,
  <span class="text-capy-400">"payload"</span>: { ... },
  <span class="text-capy-400">"error"</span>: { <span class="text-capy-400">"code"</span>: <span class="text-purple-400">400</span>, <span class="text-capy-400">"message"</span>: <span class="text-green-400">"..."</span> }
}</code></pre>
    </div>

    <!-- Message Types Accordion -->
    <div class="space-y-4">
      <!-- Authentication -->
      <details class="group bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden">
        <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-slate-800/50 transition">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
              </svg>
            </div>
            <div>
              <h3 class="font-semibold">Authentication</h3>
              <p class="text-sm text-slate-400">Handshake, pairing, tokens</p>
            </div>
          </div>
          <svg class="w-5 h-5 text-slate-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="px-6 pb-6 space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-slate-950 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-2">
                <code class="text-capy-400 font-semibold">hub_connected</code>
                <span class="text-xs px-2 py-0.5 rounded bg-capy-500/20 text-capy-400">Hub → Agent</span>
              </div>
              <pre class="text-xs text-slate-400 overflow-x-auto"><code>{
  "name": "CapyDeploy Hub",
  "version": "0.1.0",
  "platform": "windows",
  "hubId": "hub-abc123",
  "token": "stored-token-or-empty"
}</code></pre>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-2">
                <code class="text-water-400 font-semibold">pairing_required</code>
                <span class="text-xs px-2 py-0.5 rounded bg-water-500/20 text-water-400">Agent → Hub</span>
              </div>
              <pre class="text-xs text-slate-400 overflow-x-auto"><code>{
  "code": "123456",
  "expiresIn": 60
}</code></pre>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-2">
                <code class="text-capy-400 font-semibold">pair_confirm</code>
                <span class="text-xs px-2 py-0.5 rounded bg-capy-500/20 text-capy-400">Hub → Agent</span>
              </div>
              <pre class="text-xs text-slate-400 overflow-x-auto"><code>{ "code": "123456" }</code></pre>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-2">
                <code class="text-green-400 font-semibold">pair_success</code>
                <span class="text-xs px-2 py-0.5 rounded bg-green-500/20 text-green-400">Agent → Hub</span>
              </div>
              <pre class="text-xs text-slate-400 overflow-x-auto"><code>{ "token": "secure-auth-token..." }</code></pre>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <div class="flex items-center gap-2 mb-2">
                <code class="text-red-400 font-semibold">pair_failed</code>
                <span class="text-xs px-2 py-0.5 rounded bg-red-500/20 text-red-400">Agent → Hub</span>
              </div>
              <pre class="text-xs text-slate-400 overflow-x-auto"><code>{ "reason": "pairing code expired" }</code></pre>
            </div>
          </div>
        </div>
      </details>

      <!-- RPC Messages -->
      <details class="group bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden">
        <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-slate-800/50 transition">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <div>
              <h3 class="font-semibold">RPC Messages</h3>
              <p class="text-sm text-slate-400">Request/response operations</p>
            </div>
          </div>
          <svg class="w-5 h-5 text-slate-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="px-6 pb-6">
          <div class="grid gap-2 text-sm">
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">get_info</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">info_response</code>
              <span class="text-slate-500">Get Agent details and capabilities</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">get_config</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">config_response</code>
              <span class="text-slate-500">Get agent configuration</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">get_steam_users</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">steam_users_response</code>
              <span class="text-slate-500">List Steam users on device</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">list_shortcuts</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">shortcuts_response</code>
              <span class="text-slate-500">List shortcuts for a user</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">create_shortcut</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">operation_result</code>
              <span class="text-slate-500">Create a Steam shortcut</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">apply_artwork</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">artwork_response</code>
              <span class="text-slate-500">Apply artwork to shortcut</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">delete_game</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">operation_result</code>
              <span class="text-slate-500">Delete game completely (Agent handles everything)</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">delete_shortcut</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">operation_result</code>
              <span class="text-slate-500">Delete a shortcut by appID</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-capy-400 font-mono w-40">restart_steam</code>
              <span class="text-slate-400">→</span>
              <code class="text-water-400 font-mono w-40">steam_response</code>
              <span class="text-slate-500">Restart Steam client</span>
            </div>
          </div>
        </div>
      </details>

      <!-- File Upload -->
      <details class="group bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden">
        <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-slate-800/50 transition">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
            </div>
            <div>
              <h3 class="font-semibold">File Upload</h3>
              <p class="text-sm text-slate-400">Binary chunk transfers</p>
            </div>
          </div>
          <svg class="w-5 h-5 text-slate-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="px-6 pb-6 space-y-4">
          <div class="bg-slate-950 rounded-xl p-4">
            <h4 class="text-sm font-semibold text-slate-300 mb-3">Binary Chunk Format</h4>
            <pre class="text-xs text-slate-400 overflow-x-auto"><code>[4-byte header length][JSON header][binary chunk data]

JSON header:
{
  "id": "msg-id",
  "uploadId": "upload-abc123",
  "filePath": "data/game.pak",
  "offset": 0,
  "checksum": "sha256..."
}</code></pre>
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
            <div class="bg-slate-950 rounded-xl p-4">
              <code class="text-capy-400 font-semibold">init_upload</code>
              <p class="text-slate-500 text-xs mt-1">Initialize upload session</p>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <code class="text-green-400 font-semibold">upload_progress</code>
              <p class="text-slate-500 text-xs mt-1">Real-time progress events</p>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <code class="text-capy-400 font-semibold">complete_upload</code>
              <p class="text-slate-500 text-xs mt-1">Finalize and create shortcut</p>
            </div>
            <div class="bg-slate-950 rounded-xl p-4">
              <code class="text-red-400 font-semibold">cancel_upload</code>
              <p class="text-slate-500 text-xs mt-1">Cancel active upload</p>
            </div>
          </div>
        </div>
      </details>

      <!-- Push Events -->
      <details class="group bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden">
        <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-slate-800/50 transition">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
              </svg>
            </div>
            <div>
              <h3 class="font-semibold">Push Events</h3>
              <p class="text-sm text-slate-400">Real-time notifications from Agent</p>
            </div>
          </div>
          <svg class="w-5 h-5 text-slate-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="px-6 pb-6">
          <div class="grid gap-2 text-sm">
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-pink-400 font-mono w-40">upload_progress</code>
              <span class="text-slate-500">Real-time upload progress (bytes, speed, ETA)</span>
            </div>
            <div class="flex items-center gap-4 p-3 bg-slate-950 rounded-lg">
              <code class="text-pink-400 font-mono w-40">operation_event</code>
              <span class="text-slate-500">Operation progress (delete, install, restart)</span>
            </div>
          </div>
          <div class="mt-4 bg-slate-950 rounded-xl p-4">
            <h4 class="text-sm font-semibold text-slate-300 mb-3">operation_event payload</h4>
            <pre class="text-xs text-slate-400 overflow-x-auto"><code>{
  "type": "delete",      <span class="text-slate-600">// "delete", "install", etc.</span>
  "status": "progress",  <span class="text-slate-600">// "start", "progress", "complete", "error"</span>
  "gameName": "My Game",
  "progress": 50,
  "message": "Restarting Steam..."
}</code></pre>
          </div>
        </div>
      </details>
    </div>

    <!-- Timing Constants -->
    <div class="mt-8 grid md:grid-cols-2 gap-8">
      <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6">
        <h3 class="text-lg font-semibold mb-4">Timing Constants</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between py-2 border-b border-slate-800">
            <span class="text-slate-400">Write Wait</span>
            <code class="text-capy-400">10s</code>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <span class="text-slate-400">Ping Period</span>
            <code class="text-capy-400">5s</code>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <span class="text-slate-400">Pong Wait</span>
            <code class="text-capy-400">15s</code>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <span class="text-slate-400">Request Timeout</span>
            <code class="text-capy-400">30s</code>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <span class="text-slate-400">Max Message</span>
            <code class="text-capy-400">10MB</code>
          </div>
          <div class="flex justify-between py-2">
            <span class="text-slate-400">Chunk Size</span>
            <code class="text-capy-400">1MB</code>
          </div>
        </div>
      </div>

      <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6">
        <h3 class="text-lg font-semibold mb-4">Error Codes</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">400</code>
            <span class="text-slate-400">Bad Request</span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">401</code>
            <span class="text-slate-400">Unauthorized (pairing required)</span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">404</code>
            <span class="text-slate-400">Not Found</span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">406</code>
            <span class="text-slate-400">Connections blocked</span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">409</code>
            <span class="text-slate-400">Hub already connected</span>
          </div>
          <div class="flex justify-between py-2 border-b border-slate-800">
            <code class="text-red-400">500</code>
            <span class="text-slate-400">Internal Server Error</span>
          </div>
          <div class="flex justify-between py-2">
            <code class="text-red-400">501</code>
            <span class="text-slate-400">Not Implemented</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
