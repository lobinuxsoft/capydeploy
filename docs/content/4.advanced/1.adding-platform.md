---
title: Adding a Platform
description: Guide for adding new platform support
icon: ph:plus-circle-duotone
---

# Adding a Platform

:ellipsis{right=0px width=50% blur=100px}

Want to support macOS, Android, or something else? Here's how the Capabilities system makes it easy.

::alert{type="info"}
**Capabilities-First.** Agents report what they can do. Hub adapts. No hardcoded platform checks.
::

## Current Status

::card-grid
  ::card{icon=ph:check-circle-duotone}
  #title
  Full Support
  #description
  **Windows** & **Linux** — All features including Steam integration.
  ::

  ::card{icon=ph:clock-duotone}
  #title
  Planned
  #description
  **macOS** — Full support. **Android** — File transfer only (no Steam).
  ::
::

## Implementation Steps

::steps
### 1. Define Capabilities

Decide what your platform supports. Every platform gets file capabilities. Steam capabilities depend on Steam being available.

```go
// Android example - no Steam
func detectCapabilities() []protocol.Capability {
    return []protocol.Capability{
        protocol.CapFileUpload,
        protocol.CapFileList,
        // No Steam capabilities - Steam isn't on Android
    }
}
```

### 2. Create Platform-Specific Files

Use Go build tags to isolate platform code:

::code-group
```go [artwork_android.go]
//go:build android

package artwork

func Apply(config *protocol.ArtworkConfig) (*Result, error) {
    return nil, errors.New("artwork not supported on this platform")
}

func SupportedFormats() []string {
    return []string{"png", "jpg"} // No animated formats
}
```

```go [paths_android.go]
//go:build android

package steam

func GetDefaultInstallPath() string {
    return "/sdcard/CapyDeploy/Games"
}

func IsAvailable() bool {
    return false // No Steam on Android
}
```
::

### 3. Update GetInfo()

Report capabilities dynamically based on what's actually available:

```go
func (s *Server) GetInfo() protocol.AgentInfo {
    caps := []protocol.Capability{
        protocol.CapFileUpload,
        protocol.CapFileList,
    }

    // Only add Steam caps if Steam exists
    if steam.IsAvailable() {
        caps = append(caps,
            protocol.CapSteamShortcuts,
            protocol.CapSteamArtwork,
            protocol.CapSteamUsers,
            protocol.CapSteamRestart,
        )
    }

    return protocol.AgentInfo{
        ID:           s.config.ID,
        Name:         s.config.Name,
        Platform:     runtime.GOOS,
        Capabilities: caps,
    }
}
```

### 4. Update Build Scripts

Add your platform to the build system:

```bash
#!/bin/bash
case "$1" in
  android)
    export GOOS=android
    export GOARCH=arm64
    export CGO_ENABLED=1
    go build -o build/bin/capyagent-android .
    ;;
  darwin)
    export GOOS=darwin
    export GOARCH=arm64
    go build -o build/bin/capyagent-macos .
    ;;
  *)
    go build -o build/bin/capyagent .
    ;;
esac
```

### 5. Test Everything

Verify the full flow works:

::list{type="success"}
- mDNS discovery (Agent broadcasts, Hub finds it)
- WebSocket connection (`ws://agent:9999/ws`)
- Pairing (6-digit code → token)
- File upload (binary chunks over WebSocket)
- Capability adaptation (Hub UI shows/hides features)
::
::

## Files to Create

For a new platform, you'll need platform-specific implementations:

| File | Purpose |
|------|---------|
| `pkg/steam/paths_<platform>.go` | Steam paths and availability |
| `apps/agent/artwork/artwork_<platform>.go` | Image format handling |
| `apps/agent/firewall/firewall_<platform>.go` | Firewall rule management |
| `apps/agent/steam/steam_<platform>.go` | Steam process control |

## Example: macOS Implementation

::code-group
```go [paths_darwin.go]
//go:build darwin

package steam

import (
    "os"
    "path/filepath"
)

func GetSteamPath() (string, error) {
    home, _ := os.UserHomeDir()
    return filepath.Join(home, "Library/Application Support/Steam"), nil
}

func GetDefaultInstallPath() string {
    home, _ := os.UserHomeDir()
    return filepath.Join(home, "Games")
}

func IsAvailable() bool {
    path, err := GetSteamPath()
    if err != nil {
        return false
    }
    _, err = os.Stat(path)
    return err == nil
}
```

```go [steam_darwin.go]
//go:build darwin

package steam

import (
    "os/exec"
)

func Restart() error {
    // Kill Steam
    exec.Command("pkill", "-x", "Steam").Run()

    // Restart via open command
    return exec.Command("open", "-a", "Steam").Start()
}
```
::

## Important Notes

::alert{type="warning"}
**UI Framework Limitations.** Wails only supports Windows, Linux, and macOS. For Android/iOS, you'd need a different UI framework. The Go backend can be reused via [gomobile](https://pkg.go.dev/golang.org/x/mobile/cmd/gomobile).
::

::alert{type="danger"}
**Test on Real Hardware.** Emulators don't always reflect real behavior, especially for mDNS discovery and file system access.
::

## Contributing a Platform

::card{icon=ph:git-pull-request-duotone}
#title
[Contributing Guide →](/advanced/contributing)
#description
Want to add a platform? Open an issue first to discuss the approach, then submit a PR.
::
